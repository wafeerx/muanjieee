<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Game Map Editor with Mark + List</title>
  <style>
    body { font-family: sans-serif; margin: 10px; }
    canvas { border: 1px solid black; image-rendering: pixelated; display: block; }
    label { display: block; margin-top: 10px; }
    #markList { margin-top: 20px; border-top: 1px solid #ccc; padding-top: 10px; }
    .mark-item { cursor: pointer; margin-bottom: 5px; }
    .mark-item:hover { text-decoration: underline; color: blue; }
  </style>
</head>
<body>

<h2>üó∫Ô∏è Game Map Editor + Mark + Navigator</h2>

<label>
  üé® Pilih warna tile: 
  <input type="color" id="colorPicker" value="#00ff00">
</label>

<label>
  üè∑Ô∏è Tulis label/mark (opsional): 
  <input type="text" id="tileLabel" placeholder="Misal: Spawn, Boss, Shop">
</label>

<br>
<button onclick="saveMap()">üíæ Simpan Map</button>
<input type="file" id="loadMapFile" accept=".json">
<br><br>

<canvas id="gameMap" width="1000" height="1000"></canvas>

<div id="markList">
  <h3>üìç Daftar Mark/Label:</h3>
  <div id="markItems"></div>
</div>

<script>
  const canvas = document.getElementById('gameMap');
  const ctx = canvas.getContext('2d');
  const colorPicker = document.getElementById('colorPicker');
  const tileLabelInput = document.getElementById('tileLabel');
  const markItems = document.getElementById('markItems');

  const tileSize = 20;
  const mapWidth = canvas.width;
  const mapHeight = canvas.height;

  let mapData = {};

  function drawGrid() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    for (let x = 0; x < mapWidth; x += tileSize) {
      for (let y = 0; y < mapHeight; y += tileSize) {
        const key = `${x},${y}`;
        const tile = mapData[key] || { color: "#eeeeee", label: "" };

        ctx.fillStyle = tile.color;
        ctx.fillRect(x, y, tileSize, tileSize);

        ctx.strokeStyle = "#cccccc";
        ctx.strokeRect(x, y, tileSize, tileSize);

        if (tile.label) {
          ctx.fillStyle = "black";
          ctx.font = "10px sans-serif";
          ctx.fillText(tile.label, x + 2, y + tileSize - 4);
        }
      }
    }

    updateMarkList();
  }

  function updateMarkList() {
    markItems.innerHTML = ""; // Kosongkan dulu

    for (const key in mapData) {
      const tile = mapData[key];
      if (tile.label) {
        const item = document.createElement("div");
        item.className = "mark-item";
        item.textContent = `${tile.label} (${key})`;
        item.onclick = () => scrollToTile(key);
        markItems.appendChild(item);
      }
    }
  }

  function scrollToTile(key) {
    const [x, y] = key.split(',').map(Number);

    // Scroll canvas ke koordinat ‚Äî ini hanya bekerja jika canvas dalam scrollable container (dioptimalkan nanti)
    ctx.strokeStyle = "red";
    ctx.strokeRect(x, y, tileSize, tileSize);
    ctx.strokeStyle = "#cccccc";
  }

  canvas.addEventListener('click', function(event) {
    const rect = canvas.getBoundingClientRect();
    const x = Math.floor((event.clientX - rect.left) / tileSize) * tileSize;
    const y = Math.floor((event.clientY - rect.top) / tileSize) * tileSize;

    const color = colorPicker.value;
    const label = tileLabelInput.value.trim();

    const key = `${x},${y}`;
    mapData[key] = { color, label };

    drawGrid();
  });

  function saveMap() {
    const json = JSON.stringify(mapData);
    const blob = new Blob([json], { type: 'application/json' });
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = 'map_with_marks.json';
    link.click();
  }

  document.getElementById('loadMapFile').addEventListener('change', function(e) {
    const file = e.target.files[0];
    const reader = new FileReader();
    reader.onload = function(event) {
      mapData = JSON.parse(event.target.result);
      drawGrid();
    };
    reader.readAsText(file);
  });

  drawGrid();
</script>

</body>
</html>
